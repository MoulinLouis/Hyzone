$C = "../Common.ui";

@NodeStyle = ButtonStyle(
  Default: (Background: #1a2530),
  Hovered: (Background: #243342),
  Pressed: (Background: #1e2b38),
  Sounds: $C.@ButtonSounds,
);
@LockIcon = "../Textures/lock.png";

$C.@PageOverlay {
  SceneBlur {}

  Group #SkillTreeWindow {
    Anchor: (Width: 700, Height: 780);
    LayoutMode: Full;
    Background: #0d1620(0.95);
    OutlineColor: #ffffff(0.06);
    OutlineSize: 1;

    // === MAIN LAYOUT (flex container for header + content) ===
    Group {
      Anchor: (Left: 0, Right: 0, Top: 0, Bottom: 0);
      LayoutMode: Top;

    // === HEADER ===
    Group #Header {
      Anchor: (Left: 0, Right: 0, Height: 52);
      LayoutMode: Full;
      Background: #0a1018;

      // Top accent line
      Group {
        Anchor: (Left: 0, Right: 0, Top: 0, Height: 2);
        Background: #f59e0b;
      }

      Label {
        Anchor: (Left: 20, Top: 16, Width: 200, Height: 24);
        Style: (FontSize: 18, TextColor: #f0f4f8, RenderBold: true);
        Text: "Ascendancy Tree";
      }

      Group {
        Anchor: (Right: 16, Top: 10, Width: 72, Height: 32);

        TextButton #CloseButton {
          Anchor: (Left: 0, Right: 0, Top: 0, Bottom: 0);
          Text: "Close";
          Style: TextButtonStyle(
            Default: (
              Background: #ffffff(0.06),
              LabelStyle: (FontSize: 13, TextColor: #cfd7dc, HorizontalAlignment: Center, VerticalAlignment: Center)
            ),
            Hovered: (
              Background: #ffffff(0.1),
              LabelStyle: (FontSize: 13, TextColor: #f0f4f8, HorizontalAlignment: Center, VerticalAlignment: Center)
            ),
            Pressed: (
              Background: #ffffff(0.04),
              LabelStyle: (FontSize: 13, TextColor: #cfd7dc, HorizontalAlignment: Center, VerticalAlignment: Center)
            ),
            Sounds: $C.@ButtonSounds,
          );
        }
      }
    }

    // === CONTENT ===
    Group #Content {
      Anchor: (Left: 0, Right: 0);
      FlexWeight: 1;
      LayoutMode: Top;
      Padding: (Left: 16, Right: 16, Top: 8, Bottom: 12);

      // --- Points Display ---
      Group #PointsRow {
        Anchor: (Left: 0, Right: 0, Height: 36);
        LayoutMode: Full;
        Background: #ffffff(0.03);
        OutlineColor: #ffffff(0.04);
        OutlineSize: 1;

        Group {
          Anchor: (Left: 0, Top: 0, Bottom: 0, Width: 4);
          Background: #f59e0b;
        }

        Group {
          Anchor: (Left: 16, Top: 0, Bottom: 0, Right: 0);
          LayoutMode: Left;

          Label {
            Anchor: (Width: 30, Top: 0, Bottom: 0);
            Style: (FontSize: 13, TextColor: #9fb0ba, VerticalAlignment: Center);
            Text: "AP:";
          }

          Label #AvailablePoints {
            Anchor: (Width: 24, Top: 0, Bottom: 0);
            Style: (FontSize: 14, TextColor: #4ade80, RenderBold: true, VerticalAlignment: Center);
            Text: "0";
          }

          Label {
            Anchor: (Width: 20, Top: 0, Bottom: 0);
            Style: (FontSize: 13, TextColor: #4b5563, VerticalAlignment: Center);
            Text: "|";
          }

          Label {
            Anchor: (Width: 95, Top: 0, Bottom: 0);
            Style: (FontSize: 13, TextColor: #9fb0ba, VerticalAlignment: Center);
            Text: "Ascendance:";
          }

          Label #AscendanceValue {
            Anchor: (Top: 0, Bottom: 0);
            Style: (FontSize: 14, TextColor: #c084fc, RenderBold: true, VerticalAlignment: Center);
            Text: "0";
          }
        }
      }

      // --- Tree Canvas ---
      Group #TreeCanvas {
        Anchor: (Left: 0, Right: 0, Top: 8);
        FlexWeight: 1;

        Group #TreeContent {
          Anchor: (Width: 660, Height: 650);

          // Connectors: T1->T2 straight
          Group #ConnT0T1 { Anchor: (Left: 328, Top: 130, Width: 4, Height: 20); Background: #4b5563; }

          // T2->split to T3 left/right
          Group #ConnT1Split { Anchor: (Left: 328, Top: 260, Width: 4, Height: 8); Background: #4b5563; }
          Group #ConnT1H { Anchor: (Left: 160, Top: 268, Width: 340, Height: 4); Background: #4b5563; }
          Group #ConnT1Left { Anchor: (Left: 160, Top: 272, Width: 4, Height: 8); Background: #4b5563; }
          Group #ConnT1Right { Anchor: (Left: 500, Top: 272, Width: 4, Height: 8); Background: #4b5563; }

          // T3 left/right merge to T4 center
          Group #ConnT2Left { Anchor: (Left: 160, Top: 390, Width: 4, Height: 8); Background: #4b5563; }
          Group #ConnT2Right { Anchor: (Left: 500, Top: 390, Width: 4, Height: 8); Background: #4b5563; }
          Group #ConnT2H { Anchor: (Left: 160, Top: 398, Width: 340, Height: 4); Background: #4b5563; }
          Group #ConnT2Merge { Anchor: (Left: 328, Top: 402, Width: 4, Height: 8); Background: #4b5563; }

          // T4->T5 straight
          Group #ConnT3T4 { Anchor: (Left: 328, Top: 520, Width: 4, Height: 20); Background: #4b5563; }

          // Tier 1: AUTO_RUNNERS
          Button #NodeAutoRunners {
            Anchor: (Left: 250, Top: 20, Width: 160, Height: 110);
            Background: #1a2530;
            Style: @NodeStyle;
            LayoutMode: Top;
            Group #BorderAutoRunners { Anchor: (Left: 0, Right: 0, Top: 0, Height: 6); Background: #4b5563; }
            Group #RevealedAutoRunners {
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              LayoutMode: Top;
              Label { Anchor: (Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "1:1"; }
              Label #NameAutoRunners { Anchor: (Top: 2); Style: (FontSize: 13, RenderBold: true, TextColor: #f0f4f8, HorizontalAlignment: Center); Text: "Auto-Upgrade"; }
              Label #DescAutoRunners { Anchor: (Top: 4); Style: (FontSize: 11, TextColor: #6b7280, HorizontalAlignment: Center); Text: "+ Momentum"; }
              Label #StatusAutoRunners { Anchor: (Top: 6); Style: (FontSize: 12, RenderBold: true, TextColor: #6b7280, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
            Group #LockedAutoRunners {
              Visible: false;
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              Label { Anchor: (Left: 0, Right: 0, Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "1:1"; }
              Group { Anchor: (Left: 64, Top: 18, Width: 32, Height: 32); Background: @LockIcon; }
              Label { Anchor: (Left: 0, Right: 0, Top: 56); Style: (FontSize: 12, RenderBold: true, TextColor: #4b5563, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
          }

          // Tier 2: AUTO_EVOLUTION
          Button #NodeAutoEvolution {
            Anchor: (Left: 250, Top: 150, Width: 160, Height: 110);
            Background: #1a2530;
            Style: @NodeStyle;
            LayoutMode: Top;
            Group #BorderAutoEvolution { Anchor: (Left: 0, Right: 0, Top: 0, Height: 6); Background: #4b5563; }
            Group #RevealedAutoEvolution {
              Visible: false;
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              LayoutMode: Top;
              Label { Anchor: (Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "2:1"; }
              Label #NameAutoEvolution { Anchor: (Top: 2); Style: (FontSize: 13, RenderBold: true, TextColor: #f0f4f8, HorizontalAlignment: Center); Text: "Auto-Evolution"; }
              Label #DescAutoEvolution { Anchor: (Top: 4); Style: (FontSize: 11, TextColor: #6b7280, HorizontalAlignment: Center); Text: "Auto-evolve at max level"; }
              Label #StatusAutoEvolution { Anchor: (Top: 6); Style: (FontSize: 12, RenderBold: true, TextColor: #6b7280, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
            Group #LockedAutoEvolution {
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              Label { Anchor: (Left: 0, Right: 0, Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "2:1"; }
              Group { Anchor: (Left: 64, Top: 18, Width: 32, Height: 32); Background: @LockIcon; }
              Label { Anchor: (Left: 0, Right: 0, Top: 56); Style: (FontSize: 12, RenderBold: true, TextColor: #4b5563, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
          }

          // Tier 3: RUNNER_SPEED (left)
          Button #NodeRunnerSpeed {
            Anchor: (Left: 80, Top: 280, Width: 160, Height: 110);
            Background: #1a2530;
            Style: @NodeStyle;
            LayoutMode: Top;
            Group #BorderRunnerSpeed { Anchor: (Left: 0, Right: 0, Top: 0, Height: 6); Background: #4b5563; }
            Group #RevealedRunnerSpeed {
              Visible: false;
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              LayoutMode: Top;
              Label { Anchor: (Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "3:1"; }
              Label #NameRunnerSpeed { Anchor: (Top: 2); Style: (FontSize: 13, RenderBold: true, TextColor: #f0f4f8, HorizontalAlignment: Center); Text: "Runner Speed"; }
              Label #DescRunnerSpeed { Anchor: (Top: 4); Style: (FontSize: 11, TextColor: #6b7280, HorizontalAlignment: Center); Text: "x1.1 global speed"; }
              Label #StatusRunnerSpeed { Anchor: (Top: 6); Style: (FontSize: 12, RenderBold: true, TextColor: #6b7280, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
            Group #LockedRunnerSpeed {
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              Label { Anchor: (Left: 0, Right: 0, Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "3:1"; }
              Group { Anchor: (Left: 64, Top: 18, Width: 32, Height: 32); Background: @LockIcon; }
              Label { Anchor: (Left: 0, Right: 0, Top: 56); Style: (FontSize: 12, RenderBold: true, TextColor: #4b5563, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
          }

          // Tier 3: EVOLUTION_POWER (right)
          Button #NodeEvolutionPower {
            Anchor: (Left: 420, Top: 280, Width: 160, Height: 110);
            Background: #1a2530;
            Style: @NodeStyle;
            LayoutMode: Top;
            Group #BorderEvolutionPower { Anchor: (Left: 0, Right: 0, Top: 0, Height: 6); Background: #4b5563; }
            Group #RevealedEvolutionPower {
              Visible: false;
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              LayoutMode: Top;
              Label { Anchor: (Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "3:2"; }
              Label #NameEvolutionPower { Anchor: (Top: 2); Style: (FontSize: 13, RenderBold: true, TextColor: #f0f4f8, HorizontalAlignment: Center); Text: "Evolution Power+"; }
              Label #DescEvolutionPower { Anchor: (Top: 4); Style: (FontSize: 11, TextColor: #6b7280, HorizontalAlignment: Center); Text: "+1 base evo power"; }
              Label #StatusEvolutionPower { Anchor: (Top: 6); Style: (FontSize: 12, RenderBold: true, TextColor: #6b7280, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
            Group #LockedEvolutionPower {
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              Label { Anchor: (Left: 0, Right: 0, Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "3:2"; }
              Group { Anchor: (Left: 64, Top: 18, Width: 32, Height: 32); Background: @LockIcon; }
              Label { Anchor: (Left: 0, Right: 0, Top: 56); Style: (FontSize: 12, RenderBold: true, TextColor: #4b5563, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
          }

          // Tier 4: RUNNER_SPEED_2 (center)
          Button #NodeRunnerSpeed2 {
            Anchor: (Left: 250, Top: 410, Width: 160, Height: 110);
            Background: #1a2530;
            Style: @NodeStyle;
            LayoutMode: Top;
            Group #BorderRunnerSpeed2 { Anchor: (Left: 0, Right: 0, Top: 0, Height: 6); Background: #4b5563; }
            Group #RevealedRunnerSpeed2 {
              Visible: false;
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              LayoutMode: Top;
              Label { Anchor: (Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "4:1"; }
              Label #NameRunnerSpeed2 { Anchor: (Top: 2); Style: (FontSize: 13, RenderBold: true, TextColor: #f0f4f8, HorizontalAlignment: Center); Text: "Runner Speed II"; }
              Label #DescRunnerSpeed2 { Anchor: (Top: 4); Style: (FontSize: 11, TextColor: #6b7280, HorizontalAlignment: Center); Text: "x1.2 global speed"; }
              Label #StatusRunnerSpeed2 { Anchor: (Top: 6); Style: (FontSize: 12, RenderBold: true, TextColor: #6b7280, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
            Group #LockedRunnerSpeed2 {
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              Label { Anchor: (Left: 0, Right: 0, Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "4:1"; }
              Group { Anchor: (Left: 64, Top: 18, Width: 32, Height: 32); Background: @LockIcon; }
              Label { Anchor: (Left: 0, Right: 0, Top: 56); Style: (FontSize: 12, RenderBold: true, TextColor: #4b5563, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
          }

          // Tier 5: ASCENSION_CHALLENGES
          Button #NodeAscensionChallenges {
            Anchor: (Left: 250, Top: 540, Width: 160, Height: 110);
            Background: #1a2530;
            Style: @NodeStyle;
            LayoutMode: Top;
            Group #BorderAscensionChallenges { Anchor: (Left: 0, Right: 0, Top: 0, Height: 6); Background: #4b5563; }
            Group #RevealedAscensionChallenges {
              Visible: false;
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              LayoutMode: Top;
              Label { Anchor: (Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "5:1"; }
              Label #NameAscensionChallenges { Anchor: (Top: 2); Style: (FontSize: 13, RenderBold: true, TextColor: #f0f4f8, HorizontalAlignment: Center); Text: "Challenges"; }
              Label #DescAscensionChallenges { Anchor: (Top: 4); Style: (FontSize: 11, TextColor: #6b7280, HorizontalAlignment: Center); Text: "Coming Soon"; }
              Label #StatusAscensionChallenges { Anchor: (Top: 6); Style: (FontSize: 12, RenderBold: true, TextColor: #6b7280, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
            Group #LockedAscensionChallenges {
              Anchor: (Left: 0, Right: 0);
              FlexWeight: 1;
              Label { Anchor: (Left: 0, Right: 0, Top: 4); Style: (FontSize: 9, TextColor: #4b5563, HorizontalAlignment: Center); Text: "5:1"; }
              Group { Anchor: (Left: 64, Top: 18, Width: 32, Height: 32); Background: @LockIcon; }
              Label { Anchor: (Left: 0, Right: 0, Top: 56); Style: (FontSize: 12, RenderBold: true, TextColor: #4b5563, HorizontalAlignment: Center); Text: "LOCKED"; }
            }
          }
        }
      }
    }
    } // end main flex layout

    // === NODE DETAIL PANEL (overlay at bottom) ===
    Group #DetailPanel {
      Visible: false;
      Anchor: (Left: 0, Right: 0, Bottom: 0, Height: 200);
      Background: #0a1018;
      OutlineColor: #ffffff(0.08);
      OutlineSize: 1;

      // Top accent line
      Group {
        Anchor: (Left: 0, Right: 0, Top: 0, Height: 2);
        Background: #f59e0b;
      }

      Group {
        Anchor: (Left: 0, Right: 0, Top: 2, Bottom: 0);
        LayoutMode: Full;

        // Icon square (left side)
        Group #DetailIconArea {
          Anchor: (Left: 0, Top: 0, Bottom: 0, Width: 198);
          Background: #0f1923;

          Label #DetailCoord {
            Anchor: (Left: 8, Top: 6, Width: 40, Height: 18);
            Style: (FontSize: 12, TextColor: #4b5563);
            Text: "";
          }

          Group #DetailIcon {
            Anchor: (Left: 39, Top: 39, Width: 120, Height: 120);
            Background: "../Textures/golem_icon.png";
          }
        }

        // Vertical separator
        Group {
          Anchor: (Left: 198, Top: 8, Bottom: 8, Width: 1);
          Background: #ffffff(0.08);
        }

        // Text content (right side)
        Group {
          Anchor: (Left: 199, Top: 0, Bottom: 0, Right: 0);
          LayoutMode: Top;
          Padding: (Left: 20, Right: 20, Top: 14, Bottom: 14);

          // Title row
          Group {
            Anchor: (Left: 0, Right: 0, Height: 32);
            LayoutMode: Full;

            Label #DetailTitle {
              Anchor: (Left: 0, Top: 0, Bottom: 0, Width: 350);
              Style: (FontSize: 22, RenderBold: true, TextColor: #f0f4f8, VerticalAlignment: Center);
              Text: "";
            }

            // Close detail panel button
            Group {
              Anchor: (Right: 0, Top: 0, Bottom: 0, Width: 60);

              TextButton #DetailCloseBtn {
                Anchor: (Left: 0, Right: 0, Top: 0, Bottom: 0);
                Text: "Close";
                Style: TextButtonStyle(
                  Default: (
                    Background: #ffffff(0.06),
                    LabelStyle: (FontSize: 12, TextColor: #9fb0ba, HorizontalAlignment: Center, VerticalAlignment: Center)
                  ),
                  Hovered: (
                    Background: #ffffff(0.1),
                    LabelStyle: (FontSize: 12, TextColor: #f0f4f8, HorizontalAlignment: Center, VerticalAlignment: Center)
                  ),
                  Pressed: (
                    Background: #ffffff(0.04),
                    LabelStyle: (FontSize: 12, TextColor: #9fb0ba, HorizontalAlignment: Center, VerticalAlignment: Center)
                  ),
                  Sounds: $C.@ButtonSounds,
                );
              }
            }
          }

          // Description
          Label #DetailDesc {
            Anchor: (Left: 0, Right: 0, Top: 10, Height: 50);
            Style: (FontSize: 16, TextColor: #9fb0ba, Wrap: true);
            Text: "";
          }

          // Bottom row: status + unlock button
          Group {
            Anchor: (Left: 0, Right: 0, Top: 10, Height: 36);
            LayoutMode: Full;

            Label #DetailStatus {
              Anchor: (Left: 0, Top: 0, Bottom: 0, Width: 300);
              Style: (FontSize: 12, TextColor: #6b7280, VerticalAlignment: Center);
              Text: "";
            }

            // Active unlock button (enough AP)
            Group #UnlockBtnActive {
              Anchor: (Right: 0, Top: 0, Bottom: 0, Width: 150);

              TextButton #UnlockButton {
                Anchor: (Left: 0, Right: 0, Top: 0, Bottom: 0);
                Text: "1 AP";
                Style: TextButtonStyle(
                  Default: (
                    Background: #f59e0b,
                    LabelStyle: (FontSize: 13, TextColor: #0d1620, RenderBold: true, HorizontalAlignment: Center, VerticalAlignment: Center)
                  ),
                  Hovered: (
                    Background: #fbbf24,
                    LabelStyle: (FontSize: 13, TextColor: #0d1620, RenderBold: true, HorizontalAlignment: Center, VerticalAlignment: Center)
                  ),
                  Pressed: (
                    Background: #d97706,
                    LabelStyle: (FontSize: 13, TextColor: #0d1620, RenderBold: true, HorizontalAlignment: Center, VerticalAlignment: Center)
                  ),
                  Sounds: $C.@ButtonSounds,
                );
              }
            }

            // Dimmed unlock button (not enough AP)
            Group #UnlockBtnDisabled {
              Visible: false;
              Anchor: (Right: 0, Top: 0, Bottom: 0, Width: 150);
              Background: #3b3a2e;

              Label {
                Anchor: (Left: 0, Right: 0, Top: 0, Bottom: 0);
                Style: (FontSize: 13, TextColor: #7a7560, RenderBold: true, HorizontalAlignment: Center, VerticalAlignment: Center);
                Text: "1 AP";
              }
            }
          }
        }
      }
    }
  }
}
